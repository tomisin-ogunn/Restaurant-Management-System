{% extends 'layout.html' %}

{% block title %}
    Table Reservation

{% endblock %}

<body>

    {% block content %}

        <!-- Webpage Navbar -->
        <nav style="background-color:#300909" class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="{{ media_url }}RestaurantLogoDesign-FYP.png" alt="Card Image">
                </a>
                <div class="dropdown" style="float:right; margin-right: 2rem;">
                    <a style="color:white;" class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                    </svg>
                    {{ manager.first_name }} {{ manager.last_name }}
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" style="cursor:pointer" onclick="logOutConfirmation()">
                            <span style="color:black;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                                    <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                                </svg>
                            </span>
                            &nbsp;Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Manager Interface Sidebar -->
        <div class="Man-sidebar shadow-lg">
            <div class="sidebar-btn" style="border">
                <!-- Metrics Nav Button -->
                <a href="{% url 'manager-home' %}">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-graph-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07"/>
                        </svg>
                    </span> &nbsp; Metrics
                </a>
            </div>
    
            <!-- Reserve Tables Nav Button -->
            <a id="tableReserveBtn" href="{% url 'manager-table-reservation' %}">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-table" viewBox="0 0 16 16">
                        <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 2h-4v3h4zm0 4h-4v3h4zm0 4h-4v3h3a1 1 0 0 0 1-1zm-5 3v-3H6v3zm-5 0v-3H1v2a1 1 0 0 0 1 1zm-4-4h4V8H1zm0-4h4V4H1zm5-3v3h4V4zm4 4H6v3h4z"/>
                    </svg>
                </span> &nbsp; Reserve Tables
            </a>
    
            <!-- Waiter Management Nav Button -->
            <a href="{%url 'manager-waiter-management' %}">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-person-gear" viewBox="0 0 16 16">
                        <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
                    </svg> 
                </span> &nbsp; Manage Waiters
            </a>
    
            <!-- Update Menu Nav Button-->
            <a href="{% url 'manager-menu-management' %}">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-card-list" viewBox="0 0 16 16">
                        <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2z"/>
                        <path d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8m0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0M4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>
                    </svg>
                </span>&nbsp; Update Menu
            </a>
    
            <!-- Stock Level Management Button -->
            <a>
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-box-seam" viewBox="0 0 16 16">
                        <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                    </svg>
                </span> &nbsp; View Stock Levels
            </a>
    
            <!-- Customer Reviews Nav Button -->
            <a><span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-chat-quote" viewBox="0 0 16 16">
                        <path d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105"/>
                        <path d="M7.066 6.76A1.665 1.665 0 0 0 4 7.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 0 0 .6.58c1.486-1.54 1.293-3.214.682-4.112zm4 0A1.665 1.665 0 0 0 8 7.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 0 0 .6.58c1.486-1.54 1.293-3.214.682-4.112z"/>
                    </svg>
                </span> &nbsp; Customer Reviews
            </a>
    
            <!-- Log out button-->
            <a onclick="logOutConfirmation()">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                        <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                    </svg>
                </span> &nbsp; Log out
            </a>
    
        </div>

        <br><br><br>

        <!-- Table displays -->
        <div class="restaurant-tables">
            {% for table in tables|dictsort:"tableNo" %}
                    <div class="table-container" onclick="openTablePortal({{ table.tableNo }})" data-status = "{{ table.status }}"
                        style="
                            width: 80px;
                            height: {% if table.capacity == 2 %}60px{% elif table.capacity == 5 %}120px{% else %}180px{% endif %};
                            border-radius: 30px;
                            background-color:{% if table.status == "available" %} rgb(226, 226, 226) {% elif table.status == "reserved" %}
                            rgb(159, 158, 158){% endif %};
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            text-align: center;
                            font-size: 14px;
                            color: black;
                            font-weight: bold;
                            margin: 5px;
                            cursor: pointer;
                            position: relative; /* For tooltip positioning */
                            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
                        "
                        onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 8px rgba(0, 0, 0, 0.15)'; this.style.backgroundColor='#fab00f';"
                        onmouseout="setBackgroundColor(this)">
                        
                        <span>Table {{ table.tableNo }}</span>

                    </div>
            {% endfor %}
        </div>
        
        <!-- Table Portal Modal -->
        <div class="modal fade" id="tablePortalModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title d-flex align-items-center" id="exampleModalLongTitle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-info-circle me-2" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                        </svg> 
                        Table <span id="tableID" class="ms-1"></span>
                    </h5>
                </div>
                <div class="modal-body">
                  <div class="mb-3 d-flex">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="25" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
                        <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
                    </svg>
                    <span>&nbsp;&nbsp; Capacity:</span> <span id="table-capacity" class="ms-2"></span>
                  </div>

                  <div class="mb-3 d-flex">
                    <svg id="status-A" xmlns="http://www.w3.org/2000/svg" width="20" height="25" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                        <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
                    </svg>
                    <svg id="status-D" xmlns="http://www.w3.org/2000/svg" width="20" height="25" fill="currentColor" class="bi bi-calendar-check" viewBox="0 0 16 16">
                        <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0"/>
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                    </svg>
                    <span>&nbsp;&nbsp; Status:</span> <span id="table-status" class="ms-2"></span> 
                  </div> 

                  <div class="mb-3 d-flex">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="25" fill="currentColor" class="bi bi-person-badge" viewBox="0 0 16 16">
                        <path d="M6.5 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                        <path d="M4.5 0A2.5 2.5 0 0 0 2 2.5V14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2.5A2.5 2.5 0 0 0 11.5 0zM3 2.5A1.5 1.5 0 0 1 4.5 1h7A1.5 1.5 0 0 1 13 2.5v10.795a4.2 4.2 0 0 0-.776-.492C11.392 12.387 10.063 12 8 12s-3.392.387-4.224.803a4.2 4.2 0 0 0-.776.492z"/>
                      </svg>
                      <span>&nbsp;&nbsp; Waiter assigned:</span> <span id="table-waiter" class="ms-2"></span> 
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="button" id="reserveTableBtn" class="btn" style="background-color:#FFB000;" onmouseover="this.style.backgroundColor='#CC8A00';"
                    onmouseout="this.style.backgroundColor='#FFB000';" onclick="openReserveTablePortal(document.getElementById('tableID').textContent)">Reserve Table</button>
                    <button type="button" id="viewBookingBtn" class="btn" style="background-color:#FFB000;" onmouseover="this.style.backgroundColor='#CC8A00';"
                    onmouseout="this.style.backgroundColor='#FFB000';" onclick="openBookingDetailsPortal(document.getElementById('tableID').textContent)">View Booking</button>
                </div>
              </div>
            </div>
        </div> 

        <!-- Reserve Table (Booking) Modal -->
        <div class="modal fade" id="ReserveTableModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Reserve Table</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reserveTableForm" method="post" action="{% url 'create-reservation' %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="customer-name" class="form-label">Customer Name</label>
                            <input type="text" class="form-control" required name="customer-name">
                        </div>
                        <div class="mb-3">
                            <label for="tableNo" class="form-label">Table No</label>
                                <input id="reservationTableNo" type="text" name="tableNo" class="form-control" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="Date" class="form-label">Date</label>
                                <input id="reservationDate" type="date" name="reservationDate" class="form-control" disabled>
                        </div>
                        <div class="mb-3">
                            From:
                                <input type="time" required id="fromTime" name="reservationStartTime" class="form-control" min="12:00" max="22:00">
                        </div>
                        <div class="mb-3">
                            To:
                                <input type="time" required id="toTime" name="reservationEndTime" class="form-control" min="12:00" max="22:00">
                                <input type="text" name="reservationDuration" hidden id="reservationDuration">
                        </div>
                        <div class="mb-3">
                            <label for="size" name="reservationSize" class="form-label">Size</label>
                            <input type="text" required name="reservationSize" class="form-control">
                            <input type="text" name="tableCapacity" id="tableCapacity" hidden>
                        </div>
                        <div class="mb-3">
                            <label for="comment"class="form-label"> Comments</label>
                            <textarea  name="reservationComments" class="form-control"></textarea>
                        </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn" style="background-color:#FFB000;" onmouseover="this.style.backgroundColor='#CC8A00';"
                onmouseout="this.style.backgroundColor='#FFB000';">Make Booking</button>
                </div>
                </form>
            </div>
            </div>
        </div>

        <!-- View/Modify Booking Modal -->
        <div class="modal fade" id="ReservationDetailsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Reservation Details</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="tableBookingForm" method="post" action="{% url 'update-reservation' %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="customer-name" class="form-label">Customer Name</label>
                            <input type="text" class="form-control" id="upd-customer-name" required name="upd-customer-name">
                            <input type="text" name="reservationID" id="reservationID" hidden>
                        </div>
                        <div class="mb-3">
                            <label for="tableNo" class="form-label">Table No</label>
                                <input type="text" id="upd-tableNo" name="upd-tableNo" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="Date" class="form-label">Date</label>
                                <input type="date" id="upd-reservationDate" name="upd-reservationDate" class="form-control">
                        </div>
                        <div class="mb-3">
                            From:
                                <input type="time" required id="upd-fromTime" name="upd-reservationStartTime" class="form-control" min="12:00" max="22:00">
                        </div>
                        <div class="mb-3">
                            To:
                                <input type="time" required id="upd-toTime"  name="upd-reservationEndTime" class="form-control" min="12:00" max="22:00">
                                <input type="text" name="upd-reservationDuration" hidden id="reservationDuration">
                        </div>
                        <div class="mb-3">
                            <label for="size" class="form-label">Size</label>
                            <input type="text" id="upd-reservationSize" required name="upd-reservationSize" class="form-control">
                            <input type="text" name="upd-tableCapacity" id="upd-tableCapacity" hidden>
                        </div>
                        <div class="mb-3">
                            <label for="comment"class="form-label"> Comments</label>
                            <textarea id="upd-reservationComments" name="upd-reservationComments" class="form-control"></textarea>
                        </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" onclick="cancelReservation()" class="btn btn-danger">Cancel Booking</button>
                <button type="submit" class="btn" style="background-color:#FFB000;" onmouseover="this.style.backgroundColor='#CC8A00';"
                onmouseout="this.style.backgroundColor='#FFB000';">Ammend Booking</button>
                </div>
                </form>
            </div>
            </div>
        </div> 

    {% endblock %}

    <!-- Dynamic JavaScript Functionality -->

    {% block scripts %}

        {% comment %} Checks for any messages, and displays swal pop ups{% endcomment %}
        {% if messages %}
            <script>
                {% for message in messages %}

                    var messageText = "{{ message|escapejs }}"

                    {% comment %} If form is successfully submitted, display swal pop up {% endcomment %}
                    if(messageText === "Reservation added successfully!"){
                        Swal.fire({
                            icon: 'success',
                            title: 'Table Reserved!',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                //Redirects back to page
                                window.location.href="{% url 'manager-table-reservation' %}"
                            }
                        });
                    }   

                    {% comment %} If form is submitted, and size entered is bigger than table capacity, display error swal pop up {% endcomment %}
                    if(messageText === "Size is bigger than table capacity!"){
                        Swal.fire({
                            icon: 'error',
                            title: 'Capacity Exceeded!',
                            text: 'Size entered is larger than table capacity'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                //Redirects back to page
                                window.location.href="{% url 'manager-table-reservation' %}"
                            }
                        });
                    }

                     {% comment %} If form is successfully submitted, display swal pop up {% endcomment %}
                     if(messageText === "Reservation details have been updated successfully!"){
                        Swal.fire({
                            icon: 'success',
                            title: 'Reservation Updated!',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                //Redirects back to page
                                window.location.href="{% url 'manager-table-reservation' %}"
                            }
                        });
                    }   

                {% endfor %}
            </script>

        {% endif %}

        <script>


            //Function to display Swal Pop Up for when 'Log Out' is clicked
            function logOutConfirmation(){
                Swal.fire({
                    icon: 'warning',
                    title: 'Do you want to log out?',
                    showCancelButton: true,
                    confirmButtonText: 'Yes',
                    cancelButtonText: 'No',
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Logic for logging out
                        window.location.href = "{% url 'manager-logout' %}";
                    } else if (result.isDismissed) {
                        // Logic for canceling logout
                        return false;
                    }
                });
            }

            //Function to toggle navbar divs to highlight when clicked / active
            document.addEventListener("DOMContentLoaded", function () {
                let links = document.querySelectorAll(".Man-sidebar a");
                let navbtn= document.getElementById("tableReserveBtn"); // Default button
            
                // Function to set the active button
                function setActive(link) {
                    links.forEach(a => a.classList.remove("active"));
                    if (link) {
                        link.classList.add("active");
                        localStorage.setItem("activeLink", link.id); // Save active link in local storage using ID
                    }
                }
            
                // Set active class when clicked
                links.forEach(link => {
                    link.addEventListener("click", function () {
                        setActive(this);
                    });
                });
            
                // Restore active state on page load
                let savedLinkId = localStorage.getItem("activeLink");
                let activeLink = savedLinkId ? document.getElementById(savedLinkId) : null;
            
                if (activeLink) {
                    setActive(activeLink); // Restore last active button
                } else if (navbtn) {
                    setActive(navbtn); // Default to WaiterManBtn
                }
            });
            
            //Function to open table portal
            function openTablePortal(tableId) {
                fetch(`/users/get-table-details/${tableId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            
                            //Toggle status icon displays
                            if (data["status"] === "available") {
                                var availableIcon = document.getElementById("status-A");
                                var reservedIcon = document.getElementById("status-D");
                                var reserveTableBtn = document.getElementById("reserveTableBtn");
                                var viewBookingBtn = document.getElementById("viewBookingBtn");
                                var status = "Available"; 

                                if (availableIcon) availableIcon.style.display = "";
                                if (reservedIcon) reservedIcon.style.display = "none";
                                if (reserveTableBtn) reserveTableBtn.style.display = "";
                                if (viewBookingBtn) viewBookingBtn.style.display = "none";
                            }

                            else{
                                var availableIcon = document.getElementById("status-A");
                                var reservedIcon = document.getElementById("status-D");
                                var reserveTableBtn = document.getElementById("reserveTableBtn");
                                var viewBookingBtn = document.getElementById("viewBookingBtn");
                                var status = "Reserved";

                                if (availableIcon) availableIcon.style.display = "none";
                                if (reservedIcon) reservedIcon.style.display = "";
                                if (reserveTableBtn) reserveTableBtn.style.display = "none";
                                if (viewBookingBtn) viewBookingBtn.style.display = "";
                            }

                            // Populate modal fields with table details
                            document.getElementById("table-capacity").textContent = data["capacity"];
                            document.getElementById("table-status").textContent = status;

                            if((data["waiter"]["id"] === null )){
                                document.getElementById("table-waiter").textContent = "None";
                            }

                            else{
                                document.getElementById("table-waiter").textContent = data["waiter"]["id"] + ": " + data["waiter"]["name"];
                            }
                            
                            document.getElementById("tableID").textContent = tableId;

                            
                            // Show the modal after data is loaded
                            var modal = new bootstrap.Modal(document.getElementById("tablePortalModal"));
                            modal.show();
                        } else {
                            console.error("Error:", data.message);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching table details:", error);
                    });
            }

            //Function to open reserve table portal
            function openReserveTablePortal(tableId){
                fetch(`/users/get-table-details/${tableId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            
                            // Get today's date
                            const today = new Date();

                            // Format the date to YYYY-MM-DD
                            const formattedDate = today.toISOString().split('T')[0];

                            // Populate modal fields with table details
                            document.getElementById("reservationTableNo").value = tableId;
                            document.getElementById("tableCapacity").value = data["capacity"]; 
                            document.getElementById("reservationDate").value = formattedDate;
                            // Show the first modal (ReserveTableModal)
                            var modal = new bootstrap.Modal(document.getElementById("ReserveTableModal"));
                            modal.show();
                        } else {
                            console.error("Error:", data.message);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching table details:", error);
                    });
                
            }

            //Function to open reservation details (booking ammendment) portal
            function openBookingDetailsPortal(tableId){
                fetch(`/users/get-reservation-details/${tableId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            
                            // Get today's date
                            const today = new Date();

                            // Format the date to YYYY-MM-DD
                            const formattedDate = today.toISOString().split('T')[0];

                            // Enable the fields before setting values
                            let tableNoField = document.getElementById("upd-tableNo");
                            let reservationDateField = document.getElementById("upd-reservationDate");

                            console.log(reservationDateField);
                            // Set the values
                            tableNoField.value = tableId;
                            reservationDateField.value = data["reservationDate"]; 

                            // Disable them again after setting values
                            tableNoField.setAttribute("disabled", "true");
                            reservationDateField.setAttribute("disabled", "true");

                            // Populate modal fields with table details
                            document.getElementById("upd-tableCapacity").value =data["capacity"]; 
                            document.getElementById("upd-customer-name").value = data["customerName"];
                            document.getElementById("upd-reservationComments").value = data["comments"];
                            document.getElementById("upd-reservationSize").value = data["size"];
                            document.getElementById("upd-fromTime").value = data["startTime"];
                            document.getElementById("upd-toTime").value = data["endTime"];
                            document.getElementById("reservationID").value = data["reservationId"];

                            // Show the first modal (ReserveTableModal)
                            var modal = new bootstrap.Modal(document.getElementById("ReservationDetailsModal"));
                            modal.show();
                        } else {
                            console.error("Error:", data.message);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching table details:", error);
                    });
                

            }

            //Function to calculate the duration for reservation (to time - from time)
            document.addEventListener("DOMContentLoaded", function () {
                const fromTime = document.getElementById("fromTime");
                const toTime = document.getElementById("toTime");
                const durationField = document.getElementById("reservationDuration");
                const updFromTime = document.getElementById("upd-fromTime");
                const updToTime = document.getElementById("upd-toTime");
                const updurationField = document.getElementById("upd-reservationDuration");

                //Function to calculate duration for the date & time fields
                function calculateDuration() {
                    if (fromTime.value && toTime.value) {
                        // Convert time values to Date objects
                        const from = new Date(`1970-01-01T${fromTime.value}:00`);
                        const to = new Date(`1970-01-01T${toTime.value}:00`);
            
                        // Calculate the difference in minutes
                        let diffInMinutes = (to - from) / (1000 * 60); // Convert milliseconds to minutes
            
                        if (diffInMinutes < 0) {
                            durationField.value = "Invalid time range"; // Handle invalid input
                        } else {
                            durationField.value = diffInMinutes + " minutes";
                        }
                    }
                }

                //Function to calculate the updated duration for the new date & fields
                function calculateUpdatedDuration(){
                    if (fromTime.value && toTime.value) {
                        // Convert time values to Date objects
                        const updFrom = new Date(`1970-01-01T${updfromTime.value}:00`);
                        const updTo = new Date(`1970-01-01T${updtoTime.value}:00`);
            
                        // Calculate the difference in minutes
                        let updDiffInMinutes = (updTo - updFrom) / (1000 * 60); // Convert milliseconds to minutes
            
                        if (updDiffInMinutes < 0) {
                            updurationField.value = "Invalid time range"; // Handle invalid input
                        } else {
                            updurationField.value = diffInMinutes + " minutes";
                        }
                    }
                }

                // Add event listeners for input changes
                fromTime.addEventListener("change", calculateDuration);
                toTime.addEventListener("change", calculateDuration);

                updFromTime.addEventListener("change", calculateUpdatedDuration);
                updToTime.addEventListener("change", calculateUpdatedDuration);
            });

            //Event listener to enable disbaled elements input values pass through, on the form submit
            document.getElementById("reserveTableForm").addEventListener("submit", function() {
                document.getElementById("reservationDate").disabled = false;  // Enable before submit
                document.getElementById("reservationTableNo").disabled = false; //Enable before submit
            });

            //Event listener to enable disabled elements input values pass through, on the updated form submit
            document.getElementById("tableBookingForm").addEventListener("submit", function() {
                document.getElementById("upd-reservationDate").disabled = false;  // Enable before submit
                document.getElementById("upd-reservationTableNo").disabled = false; //Enable before submit
            });

            // Function to set background color based on table status
            function setBackgroundColor(element) {
                const status = element.getAttribute('data-status'); // Get table status from data attribute
                if (status === 'available') {
                    element.style.backgroundColor = 'rgb(226, 226, 226)';
                } else if (status === 'reserved') {
                    element.style.backgroundColor = 'rgb(159, 158, 158)';
                } else {
                    element.style.backgroundColor = ''; // Default case (if no status matches)
                }
                element.style.transform = 'scale(1)';  // Reset scaling
                element.style.boxShadow = 'none';      // Reset box-shadow
            }

            //Function to confirm and cancel reservation placed
            function cancelReservation() {
                document.getElementById("reservationID").hidden = false;
                var reservationId = document.getElementById("reservationID").value;

                Swal.fire({
                    icon: 'warning',
                    title: 'Do you want to cancel this booking?',
                    showCancelButton: true,
                    confirmButtonText: 'Yes',
                    cancelButtonText: 'No'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: `/users/cancelReservation/${reservationId}/`,
                            type: 'POST',
                            headers: { "X-CSRFToken": getCSRFToken() },
                            data: { id: reservationId },
                            success: function(response) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Booking Cancelled!',
                                    text: 'Your reservation has been successfully cancelled.'
                                }).then(() => {
                                    location.reload(); // Refresh the page or update the UI accordingly
                                    document.getElementById("reservationID").hidden = true;
                                });
                            },
                            error: function(xhr, status, error) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Cancellation Failed',
                                    text: 'There was an issue cancelling your booking. Please try again.'
                                });
                            }
                        });
                    }
                });
            }

            // Function to get CSRF token from cookies
            function getCSRFToken() {
                let cookieValue = null;
                let cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.startsWith('csrftoken=')) {
                        cookieValue = cookie.substring('csrftoken='.length, cookie.length);
                        break;
                    }
                }
                return cookieValue;
            }


        </script>
  
    {% endblock%}

</body>