<!-- Restaurant Manager ~ Edit Waiter Interface-->

{% extends 'layout.html' %}

{% block title %}
   Add Waiter
{% endblock %}

<body>
    {% block content %}

    <!-- Webpage Navbar -->
    <nav style="background-color:#300909" class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="{{ media_url }}RestaurantLogoDesign-FYP.png" alt="Card Image">
            </a>
            <div class="dropdown" style="float:right; margin-right: 2rem;">
                <a style="color:white;" class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                </svg>
                {{ manager.first_name }} {{ manager.last_name }}
                </a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" style="cursor:pointer" onclick="logOutConfirmation()">
                        <span style="color:black;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                                <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                            </svg>
                        </span>
                        &nbsp;Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Manager Interface Sidebar -->
    <div class="Man-sidebar shadow-lg">
        <div class="sidebar-btn" style="border">
            <a onclick= "window.location.href ='{% url 'manager-waiter-management' %}'">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                        <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                      </svg>
                </span> &nbsp; Back
            </a>
        </div>
    </div>

    <br><br><br>

    <!-- Edit Waiter form-->
    <div class="Edit-Waiter-container">
        <br>
        <form class="edit-waiter-form" method="POST" action="{% url 'update-waiter-details' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="first-name">Select Waiter</label><br>
                <div class="dropdown-container">
                    <select onchange="fetchWaiterDetails()" class="form-control custom-select" id="waiter-details" name="waiter-details" required>
                        <option value="" disabled selected style="color:gray;">Please select a waiter</option>
                        {% for waiter in waiters %}
                            <option>{{ waiter.waiterId }}: {{ waiter.first_name }} {{ waiter.last_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="first-name">First Name:</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="waiter-first-name" 
                    name="updfirst-name" 
                    required>
                <input id="waiterID" name="updWaiterID" hidden>
            </div>

            <div class="form-group">
                <label for="last-name">Last Name:</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="waiter-last-name" 
                    name="updlast-name" 
                    required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input 
                    type="email" 
                    class="form-control" 
                    id="waiter-email" 
                    name="waiter-email" 
                    required>
            </div>

            <div></div>
            <div></div>
            <div></div>
            <button type="submit" class="btn submit-button" style="width:100%; 
                background-color:#FFB000" onmouseover="this.style.backgroundColor='#CC8A00';"
                onmouseout="this.style.backgroundColor='#FFB000';" >Update Details
            </button>
                        
             <button type="button" onclick="resetForm()" class="btn btn-secondary">Clear </button>   
        </form>


    </div>

    {% endblock %}

    <!-- Dynamic JavaScript Functionality -->

    {% block scripts %}

        {% comment %} Checks for any error messages, and displays swal pop ups{% endcomment %}
        {% if messages %}
            <script>
                {% for message in messages %}
                    var messageText = "{{ message|escapejs }}"
                    
                    {% comment %} If form is successfully submitted, display swal pop up {% endcomment %}
                    if(messageText === "Waiter details have been successfully updated!"){
                        Swal.fire({
                            icon: 'success',
                            title: 'Waiter Details updated successfully!',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Redirects back to page
                                window.location.href="{% url 'edit-waiter' %}"
                            }
                        });
                    }    
               
                {% endfor %}
            </script>

        {% endif %}


        <script>

            //Function to display Swal Pop Up for when 'Log Out' is clicked
            function logOutConfirmation(){
                Swal.fire({
                    icon: 'warning',
                    title: 'Do you want to log out?',
                    showCancelButton: true,
                    confirmButtonText: 'Yes',
                    cancelButtonText: 'No',
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Logic for logging out
                        window.location.href = "{% url 'manager-logout' %}";
                    } else if (result.isDismissed) {
                        // Logic for canceling logout
                        return false;
                    }
                });
            }

            {% comment %} No input Swal Pop Up {% endcomment %}
            document.addEventListener("DOMContentLoaded", function() {
                document.getElementsByClassName("edit-waiter-form")[0].addEventListener("submit", function(event) {
                    var email = document.getElementById("waiter-email").value.trim();
                    var fname = document.getElementById("first-name").value;
                    var lname = document.getElementById("last-name").value;
                    var waiterDetails = document.getElementById("waiter-details").value;

                    // Check if the email field is empty
                    if (!email || !fname || !lname || !waiterDetails) {
                        // Show the alert if the email is empty
                        alert("Please enter all fields!");
        
                        // Prevent form submission
                        event.preventDefault();
                    }
                });
            });

            //Function to reset form values, when 'clear' button is clicked
            function resetForm(){
                var form = document.querySelector('.add-waiter-form');

                form.reset();
            }

            //Function to fetch waiter details when dropdown is changed
            function fetchWaiterDetails() {
                var waiterId = document.getElementById("waiter-details").value.substring(0, 7);

                if (waiterId) {
                    fetch(`/users/get-waiter-details/${waiterId}`)
                        .then(response => {
                            if (!response.ok) {
                                // If the response status code is not 2xx, throw an error
                                throw new Error(`HTTP error! Status: ${response.status}`);
                            }
                            return response.json();  // Parse the response as JSON only if it's successful
                        })
                        .then(data => {
                            //Display fetched data into form
                            document.getElementById("waiter-first-name").value = data["first-name"];
                            document.getElementById("waiter-last-name").value = data["last-name"];
                            document.getElementById("waiter-email").value = data["email"];
                            document.getElementById("waiterID").value = waiterId;
                        })
                        .catch(error => {
                            console.error('Error:', error);  // Handle any errors, including response issues
                        });
                }
            }


        </script>
     
    {% endblock%}

</body>






































