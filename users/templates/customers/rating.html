<!-- Restaurant Customer Ratings Interface -->

{% extends 'layout.html' %}

{% block title %}
    Restaurant Customer Ratings Interface
{% endblock %}


<body>

    {% block content %}
        <!-- Webpage Navbar -->
        <div id="navbar-menuItems">
            <nav style="background-color:#300909" class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <img src="{{ media_url }}RestaurantLogoDesign-FYP.png" alt="Card Image">
                    </a>
                    <div class="customer-auth-buttons" style="float:right; margin-right:2rem;">
                        <button onclick="window.location.href='{% url 'customer-login' %}'" class="btn" style="font-weight:bold; background-color: #FFB000; width:100%; display: flex; align-items: center; justify-content: center;" onmouseover="this.style.backgroundColor='#CC8A00';"
                        onmouseout="this.style.backgroundColor='#FFB000';"> Log In <svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/>
                            <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                          </svg>
                        </button>

                        <button onclick="window.location.href='{% url 'customer-register' %}'" class="btn btn-secondary" style="font-weight:bold; width:100%; display: flex; align-items: center; justify-content: center;">
                            Register <svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                              </svg>
                        </button>
                </div>
            </nav>
        </div>

        <!-- Customer Interface Sidebar -->
        <div class="Cus-sidebar shadow-lg">
            <a onclick="window.location.href='{% url 'customer-home' %}'">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                    </svg>
                </span> &nbsp; Home
            </a>

            <a onclick="window.location.href='{% url 'user-basket' %}'" class="basket-button">
                <span class="icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                    </svg>
                    <!-- Badge with order item count -->
                    {% if order_item_count != 0 %}
                        <span class="badge">{{ order_item_count }}</span>
                    {% endif %}
                    
                </span>
                &nbsp; Basket
            </a>

            <a id="reviewBtn">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-chat-left-text" viewBox="0 0 16 16">
                        <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                        <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6m0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"/>
                    </svg>
                </span> &nbsp; Make Review
            </a>

        </div>

        <br><br><br>

        <div class="Customer-Rating-Container">
            <br>
            <form class="add-rating-form" method="POST" action="{% url 'createCustomerRating' %}">
                <form class="add-rating-form" method="POST">
                {% csrf_token %}

                <!-- Name -->
                <div class="form-group">
                    <label for="cus-name">Name</label><br>
                    <input 
                        type="text" 
                        class="form-control" 
                        name="cus-name" 
                        placeholder="Enter your name" 
                        required>
                </div>

                <!-- Tables -->
                <div class="form-group">
                    <label for="table-select">Select your table</label><br>
                    <div class="dropdown-container">
                        <select class="form-control custom-select" id="tables" name="cus-tables" required>
                            <option value="" disabled selected style="color:gray;">Please select a table</option>
                            {% for table in tables %}
                                <option>{{ table.tableNo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Score -->
                <div class="form-group">
                    <label for="score">Select a score (out of 10) </label>
                    <input 
                        type="number" 
                        class="form-control"  
                        name="rating-score"  
                        min="1" 
                        max="10" 
                        value="1" 
                        step="1" 
                        required>
                </div>
                
                <!-- Comments -->
                <div class="form-group">
                    <label for="cus-comments">Comments</label><br>
                    <textarea class="form-control" name="cus-comments" placeholder="Please enter any comments you may have."></textarea>
                </div>

                <div></div>
                <div></div>
                <div></div>
                <button type="submit" class="btn submit-button" style="width:100%; 
                    background-color:#FFB000" onmouseover="this.style.backgroundColor='#CC8A00';"
                    onmouseout="this.style.backgroundColor='#FFB000';" >Send Feedback
                </button>
                            
                <button type="button" onclick="resetForm()" class="btn btn-secondary">Clear </button>   
            </form>
        </div>

    {% endblock %}


    <!-- Dynamic JavaScript Functionality -->
    {% block scripts %}

        {% comment %} Checks for any error messages, and displays swal pop ups{% endcomment %}
        {% if messages %}
            <script>
                {% for message in messages %}
                        var messageText = "{{ message|escapejs }}"
                            
                        {% comment %} If form is successfully submitted, display swal pop up {% endcomment %}
                        if(messageText === "Feedback sent!"){
                            Swal.fire({
                                icon: 'success',
                                title: 'Rating created!',
                                text: 'Thank you for your feedback, we will review and improve our service!'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    // Redirects back to page
                                    window.location.href="{% url 'customer-rating' %}"
                                }
                            });
                        }    
            
                    {% endfor %}

            </script>

            
        {% endif %}


        <script>

            //Sets the title for the webpage
            document.addEventListener("DOMContentLoaded", function () {
                //Set the title for the webpage
                document.title = "RMS JJ Customer";
            });

            // Function to get CSRF token from cookies
            function getCSRFToken() {
                let cookieValue = null;
                let cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.startsWith('csrftoken=')) {
                        cookieValue = cookie.substring('csrftoken='.length, cookie.length);
                        break;
                    }
                }
                return cookieValue;
            }

            //Function to toggle navbar divs to highlight when clicked / active
            document.addEventListener("DOMContentLoaded", function () {

                let links = document.querySelectorAll(".Cus-sidebar a");
                let reviewButton = document.getElementById("reviewBtn");
            
                // Function to set the active button
                function setActive(link) {
                    links.forEach(a => a.classList.remove("active"));
                    if (link) {
                        link.classList.add("active");
                        localStorage.setItem("activeLink", link.id); // Save active link in local storage
                    }
                }
            
                // Set active class when clicked
                links.forEach(link => {
                    link.addEventListener("click", function () {
                        setActive(this);
                    });
                });
            
                // Restore active state on page load
                let savedLinkId = localStorage.getItem("activeLink");
                let activeLink = savedLinkId ? document.getElementById(savedLinkId) : null;
            
                if (activeLink) {
                    setActive(activeLink); // Restore last active button
                } else if (reviewButton) {
                    setActive(reviewButton); // Default to Customer Review Button
                }
            });

            // Function to set background color based on mouseout hover
            function setBackgroundColor(element) {
                element.style.transform = 'scale(1)';  // Reset scaling
                element.style.boxShadow = '2px 2px 10px rgba(0, 0, 0, 0.1)';// Reset box-shadow
                element.style.backgroundColor = '#f8f8f8';
            }

            //Function to reset form values, when 'clear' button is clicked
            function resetForm(){
                var form = document.querySelector('.add-rating-form');

                form.reset();
            }



        </script>

    {% endblock %}

</body>

