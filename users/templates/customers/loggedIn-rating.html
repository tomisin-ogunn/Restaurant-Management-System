<!-- Restaurant Customer Ratings Interface -->

{% extends 'layout.html' %}

{% block title %}
    Restaurant Customer Logged In Ratings Interface
{% endblock %}


<body>

    {% block content %}

        <!-- Webpage Navbar -->
        <div id="navbar-menuItems">
            <nav style="background-color:#300909" class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <img src="{{ media_url }}RestaurantLogoDesign-FYP.png" alt="Card Image">
                    </a>
                    <div class="dropdown" style="float:right; margin-right: 2rem;">
                        <a style="color:white;" class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                        </svg>
                        {{ customer.first_name }} {{ customer.last_name }}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" style="cursor:pointer" onclick="logOutConfirmation()">
                                <span style="color:black;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                                        <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                                    </svg>
                                </span>
                                &nbsp;Logout</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Customer Interface Sidebar -->
        <div class="Cus-sidebar shadow-lg">
            <a onclick="window.location.href='{% url 'customer-loggedIn-home' %}'">
                <span>
                    <svg class="mb-1" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                    </svg>
                </span> &nbsp; Home
            </a>

            <!-- Favourites Button -->
            <div class="sidebar-btn" style="border">

                <!-- Favourites Button -->
                <a onclick="window.location.href='{% url 'customer-favourites' %}'">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                            <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>
                        </svg>
                    </span> &nbsp; Favourites
                </a>
            </div>

            <!-- Basket Button -->
            <a onclick="window.location.href='{% url 'customer-basket'%}'">
                <span class="icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                    </svg>
                    <!-- Badge with order item count -->
                    {% if order_item_count != 0 %}
                        <span class="badge">{{ order_item_count }}</span>
                    {% endif %}<span class="ms-3">Basket</span>
                </span>
            
            </a>

            <!-- Review Button -->
            <a id="reviewBtn">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-chat-left-text" viewBox="0 0 16 16">
                        <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                        <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6m0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"/>
                    </svg>
                </span> &nbsp; Make Review
            </a>

            <!-- Log out Button -->
            <a onclick="logOutConfirmation()">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                        <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                    </svg>
                </span> &nbsp; Log Out
            </a>

        </div>

        <br><br><br>

        <div class="Customer-Rating-Container">
            <br>
            <form class="add-rating-form" method="POST" action="{% url 'createCustomerRating' %}">
                <form class="add-rating-form" method="POST">
                {% csrf_token %}

                <!-- Name -->
                <div class="form-group">
                    <label for="cus-name">Name</label><br>
                    <input 
                        type="text" 
                        class="form-control" 
                        name="cus-name" 
                        placeholder="Enter your name" 
                        required>
                </div>

                <!-- Tables -->
                <div class="form-group">
                    <label for="table-select">Select your table</label><br>
                    <div class="dropdown-container">
                        <select class="form-control custom-select" id="tables" name="cus-tables" required>
                            <option value="" disabled selected style="color:gray;">Please select a table</option>
                            {% for table in tables %}
                                <option>{{ table.tableNo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Score -->
                <div class="form-group">
                    <label for="score">Select a score (out of 10) </label>
                    <input 
                        type="number" 
                        class="form-control"  
                        name="rating-score"  
                        min="1" 
                        max="10" 
                        value="1" 
                        step="1" 
                        required>
                </div>
                
                <!-- Comments -->
                <div class="form-group">
                    <label for="cus-comments">Comments</label><br>
                    <textarea class="form-control" name="cus-comments" placeholder="Please enter any comments you may have."></textarea>
                </div>

                <div></div>
                <div></div>
                <div></div>
                <button type="submit" class="btn submit-button" style="width:100%; 
                    background-color:#FFB000" onmouseover="this.style.backgroundColor='#CC8A00';"
                    onmouseout="this.style.backgroundColor='#FFB000';" >Send Feedback
                </button>
                            
                <button type="button" onclick="resetForm()" class="btn btn-secondary">Clear </button>   
            </form>
        </div>

    {% endblock %}

    <!-- Dynamic JavaScript Functionality -->
    {% block scripts %}

        {% comment %} Checks for any error messages, and displays swal pop ups{% endcomment %}
        {% if messages %}
            <script>
                {% for message in messages %}
                        var messageText = "{{ message|escapejs }}"
                            
                        {% comment %} If form is successfully submitted, display swal pop up {% endcomment %}
                        if(messageText === "Feedback sent!"){
                            Swal.fire({
                                icon: 'success',
                                title: 'Rating created!',
                                text: 'Thank you for your feedback, we will review and improve our service!'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    // Redirects back to page
                                    window.location.href="{% url 'customer-loggedIn-rating' %}"
                                }
                            });
                        }    
            
                    {% endfor %}

            </script>

            
        {% endif %}


        <script>

            //Sets the title for the webpage
            document.addEventListener("DOMContentLoaded", function () {
                //Set the title for the webpage
                document.title = "RMS JJ Customer";
            });

            //Function to display Swal Pop Up for when 'Log Out' is clicked
            function logOutConfirmation(){
                Swal.fire({
                    icon: 'warning',
                    title: 'Do you want to log out?',
                    showCancelButton: true,
                    confirmButtonText: 'Yes',
                    cancelButtonText: 'No',
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Logic for logging out
                        window.location.href = "{% url 'customer-logout' %}";
                    } else if (result.isDismissed) {
                        // Logic for canceling logout
                        return false;
                    }
                });
            } 

            // Function to get CSRF token from cookies
            function getCSRFToken() {
                let cookieValue = null;
                let cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.startsWith('csrftoken=')) {
                        cookieValue = cookie.substring('csrftoken='.length, cookie.length);
                        break;
                    }
                }
                return cookieValue;
            }

            //Function to toggle navbar divs to highlight when clicked / active
            document.addEventListener("DOMContentLoaded", function () {

                let links = document.querySelectorAll(".Cus-sidebar a");
                let reviewButton = document.getElementById("reviewBtn");
            
                // Function to set the active button
                function setActive(link) {
                    links.forEach(a => a.classList.remove("active"));
                    if (link) {
                        link.classList.add("active");
                        localStorage.setItem("activeLink", link.id); // Save active link in local storage
                    }
                }
            
                // Set active class when clicked
                links.forEach(link => {
                    link.addEventListener("click", function () {
                        setActive(this);
                    });
                });
            
                // Restore active state on page load
                let savedLinkId = localStorage.getItem("activeLink");
                let activeLink = savedLinkId ? document.getElementById(savedLinkId) : null;
            
                if (activeLink) {
                    setActive(activeLink); // Restore last active button
                } else if (reviewButton) {
                    setActive(reviewButton); // Default to Customer Review Button
                }
            });

            // Function to set background color based on mouseout hover
            function setBackgroundColor(element) {
                element.style.transform = 'scale(1)';  // Reset scaling
                element.style.boxShadow = '2px 2px 10px rgba(0, 0, 0, 0.1)';// Reset box-shadow
                element.style.backgroundColor = '#f8f8f8';
            }

            //Function to reset form values, when 'clear' button is clicked
            function resetForm(){
                var form = document.querySelector('.add-rating-form');

                form.reset();
            }



        </script>

    {% endblock %}

</body>

